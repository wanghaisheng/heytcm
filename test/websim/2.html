
<html><head><base href=".">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>&#x667a;&#x6167;&#x517b;&#x751f;&#x4e4b;&#x95e8;&#xff1a;&#x4e2d;&#x533b;&#x667a;&#x80fd;&#x5316;&#x63a2;&#x9669;</title>
<style>
*, *::before, *::after { 
    box-sizing: border-box; 
    margin: 0; 
    padding: 0; 
}

body {
    font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif;
    background: linear-gradient(135deg, #1a1a2e, #162447);
    color: #fff;
    min-height: 100vh;
    padding: 2rem;
}

.game-container {
    max-width: 1200px;
    margin: 2rem auto;
    min-height: 80vh;
    position: relative;
    padding: 2rem;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="rgba(0,0,0,0.5)"/><path d="M0 50 L100 50 M50 0 L50 100" stroke="rgba(255,255,255,0.1)" stroke-width="1"/></svg>') repeat;
}

.story-section {
    background-size: cover;
    background-position: center;
    transition: all 0.8s ease;
    position: relative;
    overflow: hidden;
    background: rgba(0, 0, 0, 0.8);
    border: 2px solid rgba(255, 255, 255, 0.2);
    padding: 2rem;
    margin: 2rem auto;
    border-radius: 10px;
}

.story-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.6) 100%);
    z-index: 0;
}

.story-text {
    position: relative;
    z-index: 1;
    font-size: 1.6rem;
    line-height: 1.8;
    padding: 2rem;
    background: rgba(0,0,0,0.7);
    border-radius: 15px;
    margin-bottom: 2rem;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

.option-btn {
    position: relative;
    z-index: 1;
    transform-origin: center; /* Changed from left center */
    padding: 2rem;
    margin: 1.5rem auto; /* Changed from 1.5rem 0 to center horizontally */
    font-size: 1.4rem;
    border-left: 5px solid #00ff87;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    width: 80%; /* Added width */
    max-width: 800px; /* Added max-width */
    display: block; /* Added display block */
}

.option-btn:hover {
    background: rgba(0,255,135,0.2);
    transform: scale(1.02); /* Changed from translateX(30px) scale(1.02) */
}

.options {
    margin-top: 2rem;
    display: flex;
    flex-direction: column;
    align-items: center; /* Added to center options */
    width: 100%; /* Added width */
}

.scene-enter {
    opacity: 0;
    transform: translateY(50px);
}

.scene-exit-active {
    opacity: 0;
    transform: translateY(-50px);
    transition: all 0.8s ease;
}

.result {
    font-size: 1.4rem;
    padding: 1.5rem;
    background: rgba(0,255,135,0.3);
    border-left: 5px solid #00ff87;
}

.scene-pattern {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    opacity: 0.1;
    pointer-events: none;
    background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
}

.inventory {
    position: fixed;
    right: 20px;
    bottom: 20px;
    background: rgba(0, 0, 0, 0.9);
    padding: 1.5rem;
    border-radius: 10px;
    max-width: 300px;
    border: 2px solid rgba(0, 255, 135, 0.3);
    backdrop-filter: blur(10px);
    box-shadow: 0 0 20px rgba(0, 255, 135, 0.2);
    transform: translateZ(0);
    z-index: 1000;
}

.inventory-items {
    max-height: 200px;
    overflow-y: auto;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.5rem;
    padding-right: 0.5rem;
}

.inventory-item {
  padding: 0.8rem;
  margin: 0.5rem;
  background: rgba(0, 255, 135, 0.1);
  border: 1px solid rgba(0, 255, 135, 0.3);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  animation: floatingItem 3s ease-in-out infinite;
  position: relative;
}

@keyframes floatingItem {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-5px); }
}

.inventory-item:hover {
  background: rgba(0, 255, 135, 0.2);
  transform: scale(1.05) translateY(-2px);
  box-shadow: 0 5px 15px rgba(0, 255, 135, 0.2);
}

.inventory h3 {
    margin-bottom: 0.8rem;
    font-size: 1.1rem;
}

.item-tooltip {
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    margin-bottom: 10px;
    position: absolute;
    background: rgba(0, 0, 0, 0.9);
    border: 1px solid rgba(0, 255, 135, 0.5);
    padding: 1rem;
    border-radius: 8px;
    font-size: 0.9rem;
    max-width: 250px;
    z-index: 1001;
    pointer-events: none;
    animation: tooltipFadeIn 0.3s ease;
}

@keyframes tooltipFadeIn {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
}

.progress-container {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.1);
    padding: 1rem;
    border-radius: 10px;
    z-index: 100;
}

.progress-bar {
    width: 200px;
    height: 10px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 5px;
    overflow: hidden;
}

.progress {
    width: 0%;
    height: 100%;
    background: linear-gradient(90deg, #00ff87, #60efff);
    transition: width 0.3s ease;
}

.current-level {
    text-align: center;
    margin-top: 0.5rem;
    font-size: 0.9rem;
}

.game-header {
    text-align: center;
    margin-bottom: 2rem;
}

.game-title {
    font-size: 2.5rem;
    color: #00ff87;
    text-shadow: 0 0 10px rgba(0,255,135,0.5);
    margin-bottom: 1rem;
}

.stats-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: rgba(255, 255, 255, 0.1);
    padding: 1rem;
    border-radius: 10px;
    text-align: center;
}

.stat-value {
    font-size: 1.5rem;
    color: #00ff87;
}

.stat-label {
    font-size: 0.9rem;
    opacity: 0.8;
}

.game-over {
    text-align: center;
    padding: 2rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    margin-top: 2rem;
    display: none;
}

.game-over h2 {
    color: #00ff87;
    margin-bottom: 1rem;
}

.achievement {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 255, 135, 0.2);
    padding: 2rem;
    border-radius: 15px;
    text-align: center;
    display: none;
    animation: achievementPop 0.5s ease-out;
    z-index: 1100;
    border: 2px solid #00ff87;
    box-shadow: 0 0 20px rgba(0, 255, 135, 0.3);
}

@keyframes achievementPop {
    0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
}

.result {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    background: rgba(0, 255, 135, 0.2);
    padding: 1rem;
    border-radius: 8px;
    animation: fadeIn 0.5s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.dialog-box {
    position: relative;
    background: rgba(0, 0, 0, 0.85);
    border: 2px solid #00ff87;
    padding: 2rem;
    margin: 1rem auto;
    border-radius: 15px;
    box-shadow: 0 0 20px rgba(0, 255, 135, 0.2);
    animation: dialogFadeIn 0.5s ease;
}

.character-name {
    position: absolute;
    top: -1.5rem;
    left: 2rem;
    background: #00ff87;
    color: #000;
    padding: 0.5rem 1.5rem;
    border-radius: 20px;
    font-weight: bold;
}

.dialog-text {
    font-size: 1.4rem;
    line-height: 1.8;
    color: #fff;
    text-shadow: 0 0 5px rgba(0, 255, 135, 0.5);
}

@keyframes dialogFadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.typing-cursor {
    display: inline-block;
    width: 3px;
    height: 1.4rem;
    background: #00ff87;
    margin-left: 2px;
    animation: blink 0.7s infinite;
}

@keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
}

.scene-transition {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: black;
    z-index: 1000;
    transform-origin: left;
    animation: sceneTransition 1.5s ease-in-out;
}

@keyframes sceneTransition {
    0% { transform: scaleX(0); }
    50% { transform: scaleX(1); }
    100% { transform: scaleX(0); }
}

.choice-hover-effect {
    transition: all 0.3s ease;
    transform-origin: left;
}

.choice-hover-effect:hover {
    transform: scale(1.05) translateX(20px);
    background: rgba(0, 255, 135, 0.3);
    box-shadow: 0 0 20px rgba(0, 255, 135, 0.4);
}

.notification {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 255, 135, 0.2);
    border: 2px solid #00ff87;
    padding: 1rem 2rem;
    border-radius: 20px;
    color: #fff;
    font-size: 1.2rem;
    z-index: 1000;
    animation: notificationFadeIn 0.5s ease;
}

@keyframes notificationFadeIn {
    from { opacity: 0; transform: translate(-50%, -20px); }
    to { opacity: 1; transform: translate(-50%, 0); }
}

.fade-out {
    opacity: 0;
    transform: translate(-50%, -20px);
    transition: all 0.5s ease;
}

.audio-controls {
    position: fixed;
    top: 20px;
    left: 20px;
    background: rgba(0, 0, 0, 0.9);
    padding: 1rem;
    border-radius: 10px;
    z-index: 100;
}

.sound-btn {
    width: 30px;
    height: 30px;
    border: none;
    background: none;
    cursor: pointer;
}

.sound-btn svg {
    fill: #00ff87;
    width: 24px;
    height: 24px;
}

.game-menu-toggle {
    position: fixed;
    top: 20px;
    left: 20px;
    background: rgba(0, 0, 0, 0.8);
    border: 2px solid rgba(0, 255, 135, 0.3);
    border-radius: 50%;
    width: 50px;
    height: 50px;
    cursor: pointer;
    z-index: 1100;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.game-menu-toggle:hover {
    transform: scale(1.1);
    background: rgba(0, 255, 135, 0.2);
}

.game-menu-toggle svg {
    width: 30px;
    height: 30px;
    fill: #00ff87;
}

.game-menu {
    position: fixed;
    top: 80px;
    left: 20px;
    background: rgba(0, 0, 0, 0.9);
    border: 2px solid rgba(0, 255, 135, 0.3);
    border-radius: 10px;
    padding: 1rem;
    z-index: 1100;
    transform: translateX(-120%);
    transition: transform 0.3s ease;
    backdrop-filter: blur(10px);
    min-width: 200px;
}

.game-menu.active {
    transform: translateX(0);
}

.menu-item {
    display: flex;
    align-items: center;
    padding: 1rem 1.5rem;
    margin: 0.8rem 0;
    cursor: pointer;
    border-radius: 8px;
    transition: all 0.3s ease;
    color: #fff;
    text-decoration: none;
}

.menu-item:hover {
    background: rgba(0, 255, 135, 0.2);
    transform: translateX(10px);
}

.menu-item svg {
    width: 20px;
    height: 20px;
    margin-right: 10px;
    fill: #00ff87;
}

.achievements-submenu {
    margin-top: 10px;
    padding: 15px;
    background: rgba(0, 0, 0, 0.95);
    border-radius: 12px;
    border: 1px solid rgba(0, 255, 135, 0.3);
    max-height: 300px;
    overflow-y: auto;
}

.achievements-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.achievement-list-item {
    background: rgba(0, 255, 135, 0.1);
    padding: 15px;
    border-radius: 8px;
    border: 1px solid rgba(0, 255, 135, 0.3);
    transition: all 0.3s ease;
    position: relative;
    display: flex;
    align-items: center;
    gap: 10px;
}

.achievement-list-item::before {
    content: 'ğŸ†';
    font-size: 1.2em;
}

.achievement-list-item:hover {
    background: rgba(0, 255, 135, 0.2);
    transform: translateX(5px);
    box-shadow: 0 0 15px rgba(0, 255, 135, 0.2);
}

.achievement-list-empty {
    text-align: center;
    padding: 20px;
    color: rgba(255, 255, 255, 0.6);
    font-style: italic;
}

.achievements-submenu::-webkit-scrollbar {
    width: 8px;
}

.achievements-submenu::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
}

.achievements-submenu::-webkit-scrollbar-thumb {
    background: rgba(0, 255, 135, 0.3);
    border-radius: 4px;
}

.achievements-submenu::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 255, 135, 0.5);
}

.achievement-category {
  margin-bottom: 1.5rem;
}

.achievement-category h3 {
  color: #00ff87;
  margin-bottom: 1rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid rgba(0, 255, 135, 0.3);
}

.achievement-list-item.inventory-item {
  background: rgba(0, 255, 135, 0.05);
}

.achievement-list-item.inventory-item:hover {
  background: rgba(0, 255, 135, 0.1);
}

.inventory-item .item-description {
  display: block;
  font-size: 0.8em;
  color: rgba(255, 255, 255, 0.7);
  margin-top: 0.5rem;
}

.story-progress {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.8);
    padding: 1rem 2rem;
    border-radius: 20px;
    border: 2px solid rgba(0, 255, 135, 0.3);
    z-index: 100;
    display: flex;
    align-items: center;
}

.story-progress-bar {
    width: 200px;
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    overflow: hidden;
}

.story-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #00ff87, #60efff);
    width: 0%;
    transition: width 0.5s ease;
}

.scene-transition-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: black;
    z-index: 1000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease;
}

.scene-transition-active {
    opacity: 1;
    pointer-events: auto;
}

.background-transition {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: black;
    z-index: 999;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease;
}

.background-transition.active {
    opacity: 1;
    pointer-events: auto;
}

.particle-container {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    z-index: 1;
}

.start-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #1a1a2e, #162447);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
}

.start-content {
    text-align: center;
    padding: 2rem;
    background: rgba(0, 0, 0, 0.8);
    border: 2px solid #00ff87;
    border-radius: 15px;
    animation: fadeIn 1s ease;
}

.start-description {
    text-align: left;
    margin: 2rem 0;
    padding: 2rem;
    background: rgba(0, 0, 0, 0.7);
    border-radius: 15px;
    border: 1px solid rgba(0, 255, 135, 0.3);
}

.start-description ul {
    list-style: none;
    padding: 1rem 0;
}

.start-description li {
    margin: 1rem 0;
    padding-left: 1rem;
    border-left: 3px solid #00ff87;
    transition: all 0.3s ease;
}

.start-description li:hover {
    transform: translateX(10px);
    background: rgba(0, 255, 135, 0.1);
    padding: 0.5rem 1rem;
    border-radius: 5px;
}

.start-description p {
    margin: 1rem 0;
    line-height: 1.6;
    color: #fff;
    text-shadow: 0 0 5px rgba(0, 255, 135, 0.5);
}

.start-btn {
    margin-top: 2rem;
    padding: 1rem 3rem;
    font-size: 1.5rem;
    background: rgba(0, 255, 135, 0.2);
    border: 2px solid #00ff87;
    color: #fff;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.start-btn:hover {
    background: rgba(0, 255, 135, 0.4);
    transform: translateY(-2px);
}

.character-portrait {
    position: fixed;
    bottom: 20px;
    left: 20px;
    width: 200px;
    height: 300px;
    background: rgba(0, 0, 0, 0.8);
    border: 2px solid #00ff87;
    border-radius: 10px;
    overflow: hidden;
    transition: all 0.3s ease;
}

.character-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0.8;
}

.achievement-toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: rgba(0, 255, 135, 0.2);
  border: 2px solid #00ff87;
  padding: 1rem 2rem;
  border-radius: 10px;
  color: #fff;
  font-size: 1.2rem;
  z-index: 1000;
  animation: toastFadeIn 0.5s ease;
  backdrop-filter: blur(5px);
  box-shadow: 0 0 20px rgba(0, 255, 135, 0.2);
}

@keyframes toastFadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.toast-fade-out {
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.5s ease;
}

.analysis-container {
  background: rgba(0, 0, 0, 0.9);
  padding: 2rem;
  border-radius: 15px;
  border: 2px solid #00ff87;
  margin-top: 2rem;
  animation: fadeIn 0.5s ease;
}

.analysis-title {
  color: #00ff87;
  font-size: 1.8rem;
  margin-bottom: 1rem;
  text-align: center;
}

.analysis-text {
  font-size: 1.4rem;
  line-height: 1.6;
  margin-bottom: 1rem;
  padding: 1rem;
  border-left: 4px solid #00ff87;
  background: rgba(0, 255, 135, 0.1);
}

.analysis-score {
  font-size: 2rem;
  color: #00ff87;
  text-align: center;
  margin: 2rem 0;
}

.roast-text {
  font-style: italic;
  color: #ff6b6b;
  padding: 1rem;
  border-radius: 8px;
  background: rgba(255, 107, 107, 0.1);
  margin-top: 1rem;
}

.achievement-category {
  margin-bottom: 2.5rem;
  padding: 1.5rem;
  background: rgba(0, 0, 0, 0.4);
  border-radius: 12px;
  border: 1px solid rgba(0, 255, 135, 0.3);
}

.achievement-category h3 {
  color: #00ff87;
  font-size: 1.4rem;
  margin-bottom: 1rem;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid rgba(0, 255, 135, 0.3);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.achievement-category-description {
  color: rgba(255, 255, 255, 0.7);
  font-size: 0.9rem;
  margin-bottom: 1.5rem;
  padding: 0.5rem;
  border-left: 3px solid rgba(0, 255, 135, 0.3);
  background: rgba(0, 255, 135, 0.1);
}

.achievement-list-item {
  margin-bottom: 1rem;
  padding: 1.2rem;
  background: rgba(0, 0, 0, 0.6);
  border-radius: 8px;
  border: 1px solid rgba(0, 255, 135, 0.2);
  transition: all 0.3s ease;
}

.achievement-list-item:hover {
  transform: translateX(10px);
  background: rgba(0, 255, 135, 0.1);
  border-color: rgba(0, 255, 135, 0.4);
}

.item-header, .achievement-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 0.8rem;
}

.achievement-icon {
  font-size: 1.4rem;
}

.achievement-title {
  font-size: 1.1rem;
  color: #00ff87;
}

.item-details, .achievement-details {
  margin-left: 2.4rem;
  padding-left: 1rem;
  border-left: 2px solid rgba(0, 255, 135, 0.2);
}

.item-description, .achievement-description {
  color: rgba(255, 255, 255, 0.9);
  margin-bottom: 0.5rem;
  line-height: 1.4;
}

.item-rarity, .item-acquisition, .achievement-date {
  display: block;
  font-size: 0.8rem;
  color: rgba(255, 255, 255, 0.6);
  margin-top: 0.3rem;
}

.achievement-list-empty {
  text-align: center;
  padding: 3rem 2rem;
  background: rgba(0, 0, 0, 0.4);
  border-radius: 12px;
  border: 1px solid rgba(0, 255, 135, 0.2);
}

.empty-icon {
  font-size: 3rem;
  margin-bottom: 1rem;
  opacity: 0.7;
}

.achievement-list-empty h3 {
  color: #00ff87;
  margin-bottom: 1rem;
}

.achievement-list-empty p {
  color: rgba(255, 255, 255, 0.7);
  line-height: 1.6;
}

.qr-code-section {
  margin-top: 2rem;
  text-align: center;
  background: rgba(0, 0, 0, 0.4);
  padding: 2rem;
  border-radius: 12px;
  border: 1px solid rgba(0, 255, 135, 0.3);
}

.qr-code-section h3 {
  color: #00ff87;
  margin-bottom: 1rem;
}

.qr-code-section p {
  color: rgba(255, 255, 255, 0.9);
  margin-bottom: 1rem;
}

.qr-code-container {
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 1rem auto;
  width: 200px;
  height: 200px;
  background: white;
  padding: 1rem;
  border-radius: 8px;
}

.qr-code {
  width: 100%;
  height: 100%;
}

.loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #1a1a2e, #162447);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 2500;
}

.loading-bar {
  width: 300px;
  height: 10px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 5px;
  overflow: hidden;
  margin: 20px 0;
}

.loading-progress {
  width: 0%;
  height: 100%;
  background: linear-gradient(90deg, #00ff87, #60efff);
  transition: width 0.5s ease;
}

.loading-text {
  color: #00ff87;
  font-size: 1.2rem;
  margin-top: 10px;
}
</style>
</head>
<body>
<div id="achievement" class="achievement" style="display: none;">
    <h3>&#x6210;&#x5c31;&#x89e3;&#x9501;&#xff01;</h3>
    <p id="achievementText"></p>
</div>
<div class="game-menu-toggle" id="menuToggle">
    <svg viewBox="0 0 24 24">
        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
    </svg>
</div>

<div class="game-menu" id="gameMenu">
    <div class="menu-item" onclick="saveSystem.saveGame()">
        <svg viewBox="0 0 24 24">
            <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
        </svg>
        &#x4fdd;&#x5b58;&#x6e38;&#x620f;
    </div>
    <div class="menu-item" onclick="saveSystem.loadGame()">
        <svg viewBox="0 0 24 24">
            <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"/>
        </svg>
        &#x8bfb;&#x53d6;&#x6e38;&#x620f;
    </div>
    <div class="menu-item" id="achievementsMenuItem">
        <svg viewBox="0 0 24 24">
            <path d="M19 5h-2V3H7v2H5c-1.1 0-2 .9-2 2v1c0 2.55 1.92 4.63 4.39 4.94.63 1.5 1.98 2.63 3.61 2.96V19H7v2h10v-2h-4v-3.1c1.63-.33 2.98-1.46 3.61-2.96C19.08 12.63 21 10.55 21 8V7c0-1.1-.9-2-2-2zm-2 3H7V7h10v1z"/>
        </svg>
        &#x6210;&#x5c31;&#x5217;&#x8868;
        <div class="achievements-submenu" style="display: none;">
            <div class="achievements-list" id="achievementsList"></div>
        </div>
    </div>
    <div class="menu-item" onclick="returnToHome()">
        <svg viewBox="0 0 24 24">
            <path d="M10 20v-6h4l5 5V4L14 10H10zM4 10l6 6v-6H4z"/>
        </svg>
        &#x8fd4;&#x56de;&#x4e3b;&#x9875;
    </div>
</div>

<div class="story-progress">
    <div class="story-progress-bar">
        <div class="story-progress-fill" id="storyProgressFill"></div>
    </div>
</div>

<div class="progress-container">
    <div class="progress-bar">
        <div class="progress" id="progressBar"></div>
    </div>
    <div class="current-level" id="currentLevel">&#x7b2c; 1 &#x5173; / 15 &#x5173;</div>
</div>

<div class="inventory">
    <h3>&#x6536;&#x96c4;&#x7269;&#x54c1;</h3>
    <div class="inventory-items" id="inventoryItems"></div>
</div>

<div class="game-header">
    <h1 class="game-title">&#x667a;&#x6167;&#x517b;&#x751f;&#x4e4b;&#x95e8;&#xff1a;&#x4e2d;&#x533b;&#x667a;&#x80fd;&#x5316;&#x63a2;&#x9669;</h1>
    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-value" id="questsCompleted">0</div>
            <div class="stat-label">&#x5df2;&#x5b8c;&#x6210;&#x5173;&#x5361;</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="itemsCollected">0</div>
            <div class="stat-label">&#x6536;&#x96c4;&#x7269;&#x54c1;</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="score">0</div>
            <div class="stat-label">&#x603b;&#x5206;</div>
        </div>
    </div>
</div>

<div class="game-container" id="gameContainer" style="display: none;">
    <!-- Content will be dynamically inserted here -->
    <div class="game-over" id="gameOver">
        <h2>&#x606d;&#x559c;&#x4f60;&#x5b8c;&#x6210;&#x4e86;&#x6240;&#x6709;&#x5173;&#x5361;&#xff01;</h2>
        <p>&#x4f60;&#x5df2;&#x7ecd;&#x51fa;&#x73a0;&#x8fd9;&#x4e2a;&#x9752;&#x5e38;&#x7684;&#x65c5;&#x52a0;&#x5417;&#xff1f;</p>
    </div>
</div>

<div class="start-screen" id="startScreen">
    <div class="start-content">
        <h1>&#x667a;&#x6167;&#x517b;&#x751f;&#x4e4b;&#x95e8;&#xff1a;&#x4e2d;&#x533b;&#x667a;&#x80fd;&#x5316;&#x63a2;&#x9669;</h1>
        <div class="start-description">
            <p>&#x6b22;&#x8fce;&#x6765;&#x5230;&#x8fd9;&#x4e2a;&#x6c47;&#x7ed9;&#x4e2d;&#x533b;&#x548c;&#x6700;&#x65b0;&#x6280;&#x672f;&#x7684;&#x9752;&#x5e38;&#x4e16;&#x754c;&#xff01;</p>
            <p>&#x5728;&#x6b64;&#xff0c;&#x4f60;&#x5c06;&#x641c;&#x72d0;&#xff1a;</p>
            <ul>
                <li>&#x53e4;&#x4e2d;&#x533b;&#x7684;&#x670d;&#x53cb;&#x4e16;&#x754c;</li>
                <li>&#x6700;&#x65b0;&#x6280;&#x672f;&#x7684;&#x521b;&#x4e1a;</li>
                <li>&#x667a;&#x80fd;&#x5316;&#x548c;&#x5e26;&#x751f;&#x5f53;&#x7684;&#x4e3b;&#x8981;</li>
                <li>&#x4e00;&#x4e9b;&#x7c89;&#x4e2d;&#x7684;&#x751f;&#x7269;&#x7684;&#x4f5c;&#x7528;</li>
            </ul>
            <p>&#x5df2;&#x7ecd;&#x51fa;&#x73a0;&#x8fd9;&#x4e2a;&#x9752;&#x5e38;&#x7684;&#x65c5;&#x52a0;&#x5417;&#xff1f;</p>
        </div>
        <button id="startButton" class="start-btn">&#x5f00;&#x59cb;&#x63a2;&#x9669;</button>
    </div>
</div>

<div class="audio-controls">
    <button id="toggleSound" class="sound-btn">
        <svg viewBox="0 0 24 24" width="24" height="24">
            <path fill="#00ff87" d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
        </svg>
    </button>
</div>

<div class="character-portrait">
    <img class="character-image" src alt="Character Portrait">
</div>

<div class="background-transition"></div>

<div class="particle-container"></div>

<script>const gameData = {
  currentLevel: 0,
  inventory: [],
  totalLevels: 15,
  score: 0,
  achievements: [],
  storyProgress: 0,
  textSpeed: 50
};
const gameFeatures = {
  particles: true,
  soundEffects: true,
  backgroundMusic: true,
  characterVoices: false,
  textSpeed: 50
};
const questions = [{
  story: "ä½ è¿›å…¥ä¸€åº§å¤è€çš„ä¹¦æˆ¿ï¼Œçœ‹åˆ°ä¸€æœ¬åä¸ºã€Šä¸­åŒ»çš„æœªæ¥ã€‹çš„ä¹¦ã€‚ä¹¦ä¸­æåˆ°ä¼ ç»Ÿä¸­åŒ»ä¸ç°ä»£ç§‘æŠ€çš„ç»“åˆä¹‹é“ã€‚åœ¨ä¹¦æ—ï¼Œä¸€é“ä¼ é€é—¨ç­‰å¾…ç€ä½ çš„é€‰æ‹©ã€‚",
  question: "ä½ å¦‚ä½•çœ‹å¾…ä¸­åŒ»çš„ç°ä»£åŒ–ä¸æ™ºèƒ½åŒ–å‘å±•ï¼Ÿ",
  options: [{
    text: "éå¸¸æ”¯æŒï¼Œæˆ‘è®¤ä¸ºä¸­åŒ»éœ€è¦å€ŸåŠ©ç°ä»£ç§‘æŠ€æ¥åˆ›æ–°",
    reward: "ç°ä»£æ™ºæ…§è‰è¯"
  }, {
    text: "æ„¿æ„å°è¯•ï¼Œä½†å¹¶ä¸ç¡®å®šä¸­åŒ»çš„æœªæ¥å‘å±•",
    reward: "æ¢ç´¢è‰è¯"
  }, {
    text: "ä¸æ”¯æŒï¼Œæˆ‘è®¤ä¸ºä¸­åŒ»åº”è¯¥ä¿æŒä¼ ç»Ÿ",
    reward: "ä¼ ç»Ÿç§˜æ–¹"
  }]
}, {
  story: "ä½ èµ°è¿›ä¸€åº§å®½æ•çš„å¤§å…ï¼Œçœ‹åˆ°ä¸¤ä½å­¦è€…æ¿€çƒˆè®¨è®ºï¼Œä¸€ä¸ªæ˜¯ä¸­åŒ»å¤§å¸ˆï¼Œå¦ä¸€ä¸ªæ˜¯è¥¿åŒ»ä¸“å®¶ã€‚ä»–ä»¬è¯·ä½ åŠ å…¥è®¨è®ºï¼Œè§£ç­”ä»–ä»¬ä¹‹é—´çš„äº‰è®ºã€‚",
  question: "ä½ æ˜¯å¦è®¤ä¸ºä¸­åŒ»å’Œè¥¿åŒ»å¯ä»¥äº’è¡¥ï¼Œå¸®åŠ©æ²»ç–—ç–¾ç—…ï¼Ÿ",
  options: [{
    text: "æ˜¯çš„ï¼ŒäºŒè€…å¯ä»¥äº’ç›¸è¡¥å……",
    reward: "å’Œè°ä¹‹é“"
  }, {
    text: "ä¸ç¡®å®šï¼ŒäºŒè€…æœ‰æ—¶ä¼šå†²çª",
    reward: "æ€€ç–‘ä¹‹é—¨"
  }, {
    text: "ä¸è®¤ä¸ºï¼Œè¥¿åŒ»æ‰æ˜¯å”¯ä¸€æœ‰æ•ˆçš„æ²»ç–—æ–¹æ³•",
    reward: "å•ä¸€æ²»ç–—æ³•"
  }]
}, {
  story: "ä½ è¿›å…¥äº†ä¸€åº§å……æ»¡æ™ºèƒ½è®¾å¤‡çš„å®éªŒå®¤ï¼Œå¯ä»¥å®æ—¶ç›‘æµ‹èº«ä½“å¥åº·ã€‚ä½ é¢å‰çš„è®¾å¤‡å¯ä»¥é€šè¿‡æ•°æ®å¸®åŠ©ä½ äº†è§£èº«ä½“çŠ¶å†µã€‚",
  question: "ä½ æ˜¯å¦æ„¿æ„ä½¿ç”¨æ™ºèƒ½è®¾å¤‡æ¥è·Ÿè¸ªä½ çš„å¥åº·æ•°æ®ï¼Ÿ",
  options: [{
    text: "éå¸¸æ„¿æ„ï¼Œæˆ‘è®¤ä¸ºå®ƒæœ‰åŠ©äºæ›´å¥½åœ°ç®¡ç†å¥åº·",
    reward: "å¥åº·ä¹‹çœ¼"
  }, {
    text: "æ„¿æ„ï¼Œä½†éœ€è¦æ›´å¤šäº†è§£",
    reward: "æ•°æ®æ¢ç´¢è€…"
  }, {
    text: "ä¸æ„¿æ„ï¼Œæˆ‘æ›´å€¾å‘äºä¼ ç»Ÿå¥åº·ç®¡ç†æ–¹å¼",
    reward: "ä¼ ç»Ÿä¹‹é“"
  }]
}, {
  story: "ä½ æ¥åˆ°ä¸€åº§å±•è§ˆé¦†ï¼Œå±•ç¤ºäº†å„ç§ä¸­åŒ»å…»ç”Ÿäº§å“ã€‚è¿™äº›äº§å“åŸºäºå¤šç§ä¼ ç»Ÿç†è®ºã€‚",
  question: "ä½ æ˜¯å¦äº†è§£è¿‡æˆ–æ­£åœ¨ä½¿ç”¨åŸºäºä¼ ç»Ÿä¸­åŒ»ç†è®ºçš„å…»ç”Ÿäº§å“å—ï¼Ÿ",
  options: [{
    text: "æ˜¯çš„ï¼Œå·²ç»åœ¨ä½¿ç”¨å¹¶çœ‹åˆ°ä¸€å®šæ•ˆæœ",
    reward: "è°ƒå’Œè¯å‰‚"
  }, {
    text: "æœ‰äº†è§£è¿‡ï¼Œä½†è¿˜æ²¡æœ‰ä½¿ç”¨",
    reward: "å­¦ä¹ ä¹‹è·¯"
  }, {
    text: "ä¸å¤ªäº†è§£ï¼Œä¹Ÿæ²¡æœ‰å…´è¶£ä½¿ç”¨",
    reward: "ä¼ ç»Ÿæ™ºæ…§"
  }]
}, {
  story: "ä½ è¿›å…¥äº†ä¸€é—´æ•°æ®ä¸­å¿ƒï¼Œçœ‹åˆ°å‘Šç¤ºæ¿ä¸Šå†™ç€ï¼šå¼€æ”¾æ•°æ®åŠ©åŠ›ä¸­åŒ»æ™ºèƒ½åŒ–ç ”ç©¶ã€‚",
  question: "ä½ æ˜¯å¦æ”¯æŒé€šè¿‡å¼€æ”¾æ•°æ®å’Œå…±äº«çš„æ–¹å¼æ¥ä¿ƒè¿›ä¸­åŒ»æ™ºèƒ½åŒ–ç ”ç©¶ï¼Ÿ",
  options: [{
    text: "å®Œå…¨æ”¯æŒï¼Œæˆ‘è®¤ä¸ºè¿™å¯¹ç¤¾ä¼šå’Œç§‘ç ”æœ‰ç›Š",
    reward: "æ•°æ®å…±äº«"
  }, {
    text: "ä¸­ç«‹ï¼Œå–å†³äºå¦‚ä½•ä½¿ç”¨æˆ‘çš„æ•°æ®",
    reward: "è°¨æ…ä¹‹é“"
  }, {
    text: "ä¸æ”¯æŒï¼Œæˆ‘ä¸æ„¿æ„åˆ†äº«ä¸ªäººå¥åº·æ•°æ®",
    reward: "ä¿å®ˆè€…"
  }]
}, {
  story: "ä½ æ¥åˆ°äº†ä¸€ä¸ªç°ä»£åŒ–çš„å¥åº·è¿½è¸ªå®¤ï¼Œæˆ¿é—´é‡Œæ‘†æ»¡äº†å„ç§è®¾å¤‡å’Œå·¥å…·ã€‚",
  question: "ä½ æ˜¯å¦æ„¿æ„é€šè¿‡å®šæœŸè¿½è¸ªå’Œç®¡ç†å¥åº·æŒ‡æ ‡æ¥å®ç°ä¸ªæ€§åŒ–çš„å…»ç”Ÿå»ºè®®å’Œç›®æ ‡ï¼Ÿ",
  options: [{
    text: "å®Œå…¨æ„¿æ„ï¼Œæˆ‘è®¤ä¸ºå®šæœŸè¿½è¸ªæœ‰åŠ©äºæŒç»­æ”¹è¿›å¥åº·",
    reward: "å¥åº·ä¹‹é“"
  }, {
    text: "æ„¿æ„ï¼Œä½†ä¸ç¡®å®šæ˜¯å¦èƒ½åšæŒ",
    reward: "æ¢ç´¢ä¹‹é’¥"
  }, {
    text: "ä¸æ„¿æ„ï¼Œæˆ‘è®¤ä¸ºå¶å°”äº†è§£å¥åº·çŠ¶å†µå³å¯",
    reward: "è‡ªç”±ä¹‹ç¬¦"
  }]
}, {
  story: "ä½ æ¥åˆ°ä¸€åº§å±•è§ˆä¼šï¼Œå±•å‡ºè®¸å¤šæ™ºèƒ½æ‰‹ç¯ã€æ‰‹è¡¨ç­‰å¯ç©¿æˆ´è®¾å¤‡ã€‚",
  question: "ä½ å¯¹å¯ç©¿æˆ´è®¾å¤‡åœ¨å¥åº·ç®¡ç†ä¸­çš„ä½œç”¨æœ‰ä½•çœ‹æ³•ï¼Ÿ",
  options: [{
    text: "æˆ‘è®¤ä¸ºå®ƒä»¬éå¸¸æœ‰æ•ˆï¼Œå¯ä»¥å¸®åŠ©æˆ‘å®æ—¶äº†è§£å¥åº·çŠ¶å†µ",
    reward: "å®æ—¶å¥åº·"
  }, {
    text: "æˆ‘è§‰å¾—å®ƒä»¬æœ‰ä¸€å®šä½œç”¨ï¼Œä½†ä¸ç¡®å®šæ˜¯å¦è¶³å¤Ÿé‡è¦",
    reward: "æ™ºèƒ½æ¢ç´¢è€…"
  }, {
    text: "ä¸è®¤ä¸ºï¼Œä»–ä»¬æœ‰ç”¨ï¼Œä¹ æƒ¯é€šè¿‡ä¼ ç»Ÿæ–¹å¼ç®¡ç†å¥åº·",
    reward: "ä¼ ç»ŸæŠ¤ç¬¦"
  }]
}, {
  story: "ä½ åœ¨ä¸€ä¸ªç°ä»£åŒ–çš„æ•°æ®åˆ†æä¸­å¿ƒçœ‹åˆ°è®¸å¤šæ²»ç–—å·¥å…·å’Œå»ºè®®ã€‚",
  question: "ä½ æ˜¯å¦æ”¯æŒåˆ©ç”¨å¤§æ•°æ®å’Œäººå·¥æ™ºèƒ½æ¥ä¼˜åŒ–ä¸­åŒ»çš„è¯Šæ–­å’Œæ²»ç–—æ–¹æ¡ˆï¼Ÿ",
  options: [{
    text: "å®Œå…¨æ”¯æŒï¼Œæˆ‘è®¤ä¸ºå¤§æ•°æ®å¯ä»¥å¸®åŠ©æ”¹å–„ä¸­åŒ»æ²»ç–—æ•ˆæœ",
    reward: "å¤§æ•°æ®åˆ†æ"
  }, {
    text: "æ”¯æŒï¼Œä½†éœ€è¦å°å¿ƒä½¿ç”¨",
    reward: "ä¼ ç»Ÿä¸ç°ä»£èåˆ"
  }, {
    text: "ä¸æ”¯æŒï¼Œæˆ‘è®¤ä¸ºä¸­åŒ»åº”åšæŒä¼ ç»Ÿè¯Šç–—æ–¹æ³•",
    reward: "ä¼ ç»Ÿä¹‹é“"
  }]
}, {
  story: "ä½ èµ°è¿›ä¸€ä¸ªå……æ»¡è‰è¯å’Œä¼ ç»Ÿä¸­åŒ»è¯æ–¹çš„é¦†å†…ã€‚",
  question: "ä½ æ˜¯å¦å€¾å‘äºé€‰æ‹©è‡ªç„¶è‰è¯ç–—æ³•æ¥å¤„ç†æ—¥å¸¸å¥åº·é—®é¢˜ï¼Ÿ",
  options: [{
    text: "å®Œå…¨å€¾å‘ï¼Œè‰è¯ç–—æ³•è‡ªç„¶ã€å®‰å…¨",
    reward: "è‰è¯ä¹‹é“"
  }, {
    text: "ä¸ç¡®å®šï¼Œå¶å°”ä½¿ç”¨è‰è¯æ²»ç–—",
    reward: "è‰è¯æ¢ç´¢è€…"
  }, {
    text: "ä¸å€¾å‘ï¼Œæˆ‘æ›´å–œæ¬¢ç°ä»£åŒ»å­¦æ²»ç–—æ–¹æ³•",
    reward: "ç°ä»£åŒ»å­¦"
  }]
}, {
  story: "ä½ è¿›å…¥äº†ä¸€é—´æ•°æ®ä¸­å¿ƒï¼Œçœ‹åˆ°ä¸€ä¸ªå¤§å±å¹•æ˜¾ç¤ºç€ä¸­åŒ»å¥åº·æ•°æ®çš„åˆ†æã€‚",
  question: "ä½ æ˜¯å¦æ„¿æ„æ¥å—æ ¹æ®ä¸ªäººå¥åº·æ•°æ®é‡èº«å®šåˆ¶çš„ä¸­åŒ»æ²»ç–—æ–¹æ¡ˆï¼Ÿ",
  options: [{
    text: "æ„¿æ„ï¼Œè®¤ä¸ºè¿™å¯ä»¥æé«˜æ²»ç–—çš„æœ‰æ•ˆæ€§",
    reward: "ä¸ªæ€§åŒ–æ²»ç–—"
  }, {
    text: "æ„¿æ„å°è¯•ï¼Œä½†ä»ç„¶å¯¹å…¶æ•ˆæœä¿æŒæ€€ç–‘",
    reward: "å°è¯•ä¹‹é“"
  }, {
    text: "ä¸æ„¿æ„ï¼Œæˆ‘æ›´å–œæ¬¢å¸¸è§„æ²»ç–—æ–¹æ³•",
    reward: "ä¼ ç»Ÿç–—æ³•"
  }]
}, {
  story: "ä½ èµ°è¿›ä¸€ä¸ªç°ä»£åŒ–çš„å¥åº·ç®¡ç†å®éªŒå®¤ã€‚",
  question: "ä½ æ˜¯å¦æ„¿æ„æ¥å—æŠ€æœ¯æ”¯æŒæ¥ç®¡ç†å’Œä¼˜åŒ–è‡ªå·±çš„å¥åº·çŠ¶å†µï¼Ÿ",
  options: [{
    text: "å®Œå…¨æ„¿æ„ï¼Œç§‘æŠ€çš„è¾…åŠ©èƒ½æé«˜æˆ‘çš„å¥åº·æ°´å¹³",
    reward: "ç§‘æŠ€å¥åº·"
  }, {
    text: "æœ‰äº›çŠ¹è±«ï¼Œæˆ‘è§‰å¾—è¿‡åº¦ä¾èµ–æŠ€æœ¯å¯èƒ½ä¼šå¤±å»è‡ªä¸»æ€§",
    reward: "å¥åº·ä¹‹é“"
  }, {
    text: "ä¸æ„¿æ„ï¼Œæˆ‘æ›´å€¾å‘äºè‡ªç„¶çš„å¥åº·ç®¡ç†æ–¹å¼",
    reward: "ä¼ ç»Ÿæ™ºæ…§"
  }]
}, {
  story: "ä½ æ¥åˆ°ä¸€åº§æƒ…ç»ªè°ƒèŠ‚å¤§å…ï¼Œçœ‹åˆ°å„ç§ä¸­åŒ»æƒ…ç»ªæ²»ç–—çš„æ–¹æ³•ã€‚",
  question: "ä½ æ˜¯å¦è®¤ä¸ºä¸­åŒ»èƒ½æœ‰æ•ˆæ”¹å–„æƒ…ç»ªå¥åº·ï¼Ÿ",
  options: [{
    text: "å®Œå…¨è®¤ä¸ºï¼Œä¸­åŒ»æœ‰åŠ©äºè°ƒèŠ‚æƒ…ç»ªå’Œå‹åŠ›",
    reward: "æƒ…ç»ªæ²»ç–—"
  }, {
    text: "æœ‰ä¸€å®šæ•ˆæœï¼Œä½†æ›´ä¾èµ–äºä¸ªäººæƒ…å†µ",
    reward: "æƒ…ç»ªè°ƒèŠ‚ä¹‹é“"
  }, {
    text: "ä¸è®¤ä¸ºï¼Œä¸­åŒ»æ— æ³•æœ‰æ•ˆè°ƒèŠ‚æƒ…ç»ª",
    reward: "ç°ä»£æƒ…ç»ªç®¡ç†"
  }]
}, {
  story: "ä½ åœ¨ä¸€ä¸ªç°ä»£åŒ–çš„è‡ªæˆ‘ç–—æ³•ç«™ç‚¹çœ‹åˆ°è®¸å¤šæ²»ç–—å·¥å…·å’Œå»ºè®®ã€‚",
  question: "ä½ æ˜¯å¦å€¾å‘äºè‡ªæˆ‘æ²»ç–—æ¥æé«˜èº«ä½“å¥åº·ï¼Ÿ",
  options: [{
    text: "æ˜¯çš„ï¼Œè‡ªæˆ‘æ²»ç–—æœ‰åŠ©äºæˆ‘çš„èº«å¿ƒå¥åº·",
    reward: "è‡ªæˆ‘ç–—æ³•"
  }, {
    text: "æœ‰äº›å°è¯•è¿‡ï¼Œä½†æ•ˆæœä¸ä¸€",
    reward: "æ¢ç´¢ä¹‹é“"
  }, {
    text: "ä¸å€¾å‘ï¼Œæˆ‘æ›´å–œæ¬¢å¯»æ±‚ä¸“ä¸šåŒ»ç–—å¸®åŠ©",
    reward: "ä¸“ä¸šåŒ»ç–—"
  }]
}, {
  story: "ä½ æ¥åˆ°äº†æ¸¸æˆçš„æœ€ç»ˆåŒºåŸŸï¼Œé¢å¯¹ç€æœªæ¥å¥åº·çš„è“å›¾ã€‚",
  question: "ä½ å¦‚ä½•çœ‹å¾…æœªæ¥å¥åº·ç®¡ç†ä¸ç§‘æŠ€ç»“åˆçš„å‰æ™¯ï¼Ÿ",
  options: [{
    text: "æä¸ºæœŸå¾…ï¼Œç§‘æŠ€å°†å½»åº•æ”¹å˜æˆ‘ä»¬çš„å¥åº·ç®¡ç†æ–¹å¼",
    reward: "æœªæ¥å¥åº·"
  }, {
    text: "ä¸­ç«‹ï¼ŒæœŸå¾…ç§‘æŠ€è¿›æ­¥ï¼Œä½†ä¹Ÿæœ‰äº›æ‹…å¿§",
    reward: "å¹³è¡¡ä¹‹é“"
  }, {
    text: "ä¸å¤ªæœŸå¾…ï¼Œæˆ‘æ›´ç›¸ä¿¡ä¼ ç»Ÿçš„å¥åº·ç®¡ç†æ–¹å¼",
    reward: "ä¼ ç»Ÿä¿¡å¿µ"
  }]
}, {
  story: "ä½ æ¥åˆ°äº†æ¸¸æˆçš„ç»ˆç‚¹ï¼Œé¢å¯¹ç€ä¸€ä¸ªå¤è€çš„æ™ºæ…§å®ç›’ã€‚",
  question: "ä½ è®¤ä¸ºæœªæ¥ç§‘æŠ€ä¸ä¼ ç»Ÿä¸­åŒ»èƒ½å¦æˆåŠŸèåˆï¼Œåˆ›é€ å‡ºæ›´å¥½çš„å¥åº·ç®¡ç†æ–¹æ³•ï¼Ÿ",
  options: [{
    text: "è®¤ä¸ºå¯ä»¥ï¼Œæœªæ¥ç§‘æŠ€å’Œä¸­åŒ»ä¼šæ‰¾åˆ°å®Œç¾çš„ç»“åˆç‚¹",
    reward: "æ™ºæ…§èåˆ"
  }, {
    text: "è®¤ä¸ºæœ‰ä¸€å®šæŒ‘æˆ˜ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½èåˆæˆåŠŸ",
    reward: "èåˆæ¢ç´¢è€…"
  }, {
    text: "ä¸è®¤ä¸ºï¼Œç§‘æŠ€å’Œä¸­åŒ»æ— æ³•å®Œå…¨èåˆ",
    reward: "ä¼ ç»Ÿä¹‹é“"
  }]
}];
const achievementList = [];
const achievementSystem = {
  achievements: [],
  unlock(id, title, description) {
    if (!this.achievements.includes(id)) {
      this.achievements.push(id);
      showAchievement(title);
      this.updateAchievementList();
    }
  },
  updateAchievementList() {
    const list = document.getElementById('achievementsList');
    if (list) {
      list.innerHTML = this.achievements.map(id => `<div class="achievement-item">${id}</div>`).join('');
    }
  }
};
class ParticleSystem {
  constructor() {
    this.particles = [];
    this.container = document.createElement('div');
    this.container.className = 'particle-container';
    document.body.appendChild(this.container);
  }
  createParticle(x, y) {
    const particle = document.createElement('div');
    particle.style.cssText = `
      position: absolute;
      width: 4px;
      height: 4px;
      background: #00ff87;
      border-radius: 50%;
      left: ${x}px;
      top: ${y}px;
      pointer-events: none;
    `;
    this.container.appendChild(particle);
    const angle = Math.random() * Math.PI * 2;
    const velocity = Math.random() * 2 + 1;
    const lifetime = Math.random() * 1000 + 500;
    return {
      element: particle,
      angle,
      velocity,
      lifetime,
      birth: Date.now()
    };
  }
  emit(x, y, count = 10, type = 'default') {
    const colors = {
      default: '#00ff87',
      achievement: '#ffd700',
      transition: '#ffffff'
    };
    for (let i = 0; i < count; i++) {
      const particle = document.createElement('div');
      particle.style.cssText = `
        position: absolute;
        width: ${type === 'transition' ? '6px' : '4px'};
        height: ${type === 'transition' ? '6px' : '4px'};
        background: ${colors[type]};
        border-radius: 50%;
        left: ${x}px;
        top: ${y}px;
        pointer-events: none;
        filter: blur(1px);
        box-shadow: 0 0 5px ${colors[type]};
      `;
      this.container.appendChild(particle);
      const angle = Math.random() * Math.PI * 2;
      const velocity = Math.random() * 2 + (type === 'transition' ? 2 : 1);
      const lifetime = Math.random() * 1000 + (type === 'transition' ? 1000 : 500);
      this.particles.push({
        element: particle,
        angle,
        velocity,
        lifetime,
        birth: Date.now()
      });
    }
  }
  update() {
    const now = Date.now();
    this.particles = this.particles.filter(particle => {
      const age = now - particle.birth;
      if (age > particle.lifetime) {
        particle.element.remove();
        return false;
      }
      const x = parseFloat(particle.element.style.left);
      const y = parseFloat(particle.element.style.top);
      particle.element.style.left = `${x + Math.cos(particle.angle) * particle.velocity}px`;
      particle.element.style.top = `${y + Math.sin(particle.angle) * particle.velocity}px`;
      particle.element.style.opacity = 1 - age / particle.lifetime;
      return true;
    });
  }
}
function getItemDescription(item) {
  const descriptions = {
    "ç°ä»£æ™ºæ…§è‰è¯": "èåˆç°ä»£ç§‘æŠ€ä¸ä¼ ç»Ÿä¸­åŒ»çš„æ™ºæ…§ç»“æ™¶ï¼Œè•´å«å¼ºå¤§çš„æ²»æ„ˆèƒ½åŠ›ã€‚",
    "æ¢ç´¢è‰è¯": "ä¸€æ ªç¥ç§˜çš„è‰è¯ï¼Œæ•£å‘ç€æ·¡æ·¡çš„å…‰èŠ’ï¼Œä¼¼ä¹åœ¨ç­‰å¾…è¢«å‘ç°ã€‚",
    "ä¼ ç»Ÿç§˜æ–¹": "å¤è€çš„åŒ»ä¹¦ä¸­è®°è½½çš„ç¥ç§˜é…æ–¹ï¼Œä¼ æ‰¿äº†æ•°åƒå¹´çš„æ™ºæ…§ã€‚",
    "å’Œè°ä¹‹é“": "è±¡å¾ç€ä¸­è¥¿åŒ»å’Œè°å…±å­˜çš„è‡³ç†ï¼Œé—ªè€€ç€é‡‘è‰²çš„å…‰èŠ’ã€‚",
    "æ€€ç–‘ä¹‹é—¨": "ä¸€æ‰‡åŠå¼€çš„é—¨ï¼Œé€šå‘æœªçŸ¥çš„é¢†åŸŸï¼Œè€ƒéªŒç€æ¢ç´¢è€…çš„æ™ºæ…§ã€‚",
    "å•ä¸€æ²»ç–—æ³•": "ä»£è¡¨ç€ä¸“æ³¨ä¸æ‰§ç€çš„æ²»ç–—ä¹‹é“ï¼Œæ•£å‘ç€çº¯ç²¹çš„èƒ½é‡ã€‚"
  };
  return descriptions[item] || "ä¸€ä»¶ç¥ç§˜çš„ç‰©å“ï¼Œç­‰å¾…ç€è¢«äº†è§£å’Œä½¿ç”¨ã€‚";
}
function showItemDescription(description, element) {
  const existingTooltip = document.querySelector('.item-tooltip');
  if (existingTooltip) {
    existingTooltip.remove();
  }
  const tooltip = document.createElement('div');
  tooltip.className = 'item-tooltip';
  tooltip.style.cssText = `
        position: absolute;
        background: rgba(0, 0, 0, 0.9);
        border: 1px solid rgba(0, 255, 135, 0.5);
        padding: 1rem;
        border-radius: 8px;
        font-size: 0.9rem;
        max-width: 250px;
        z-index: 1001;
        pointer-events: none;
        animation: tooltipFadeIn 0.3s ease;
    `;
  tooltip.textContent = description;
  const rect = element.getBoundingClientRect();
  tooltip.style.left = `${rect.right + 10}px`;
  tooltip.style.top = `${rect.top}px`;
  document.body.appendChild(tooltip);
  const style = document.createElement('style');
  style.textContent = `
        @keyframes tooltipFadeIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }
    `;
  document.head.appendChild(style);
  element.addEventListener('mouseleave', () => {
    tooltip.remove();
  });
}
function animateText(text, element) {
  const speed = 30;
  let i = 0;
  element.textContent = '';
  return new Promise(resolve => {
    function addChar() {
      if (i < text.length) {
        element.textContent += text.charAt(i);
        if (text.charAt(i) !== ' ' && text.charAt(i) !== '\n') {
          const audio = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==');
          audio.volume = 0.1;
          audio.play().catch(() => {});
        }
        i++;
        setTimeout(addChar, speed);
      } else {
        resolve();
      }
    }
    addChar();
  });
}
function createOptionButton(option, container) {
  const button = document.createElement('button');
  button.className = 'option-btn';
  button.textContent = option.text;
  button.addEventListener('click', () => {
    const optionsContainer = container.querySelector('.options');
    optionsContainer.querySelectorAll('button').forEach(btn => {
      btn.disabled = true;
      btn.style.opacity = '0.5';
    });
    const resultElement = document.createElement('div');
    resultElement.className = 'result';
    resultElement.textContent = `è·å¾—ï¼š${option.reward}`;
    container.appendChild(resultElement);
    resultElement.style.display = 'block';
    gameData.inventory.push(option.reward);
    const toast = document.createElement('div');
    toast.className = 'achievement-toast';
    toast.innerHTML = `
      <h3>è·å¾—ç‰©å“ï¼</h3>
      <p>${option.reward}</p>
    `;
    document.body.appendChild(toast);
    setTimeout(() => {
      toast.classList.add('toast-fade-out');
      setTimeout(() => {
        toast.remove();
      }, 500);
    }, 5000);
    if (gameData.inventory.length === 5) {
      showAchievement('æ”¶é›†è€…ï¼šè·å¾—5ä»¶ç‰©å“ï¼');
    } else if (gameData.inventory.length === 10) {
      showAchievement('æ¢ç´¢å¤§å¸ˆï¼šè·å¾—10ä»¶ç‰©å“ï¼');
    }
    const choiceValue = {
      "éå¸¸æ”¯æŒï¼Œæˆ‘è®¤ä¸ºä¸­åŒ»éœ€è¦å€ŸåŠ©ç°ä»£ç§‘æŠ€æ¥åˆ›æ–°": 100,
      "æ„¿æ„å°è¯•ï¼Œä½†å¹¶ä¸ç¡®å®šä¸­åŒ»çš„æœªæ¥å‘å±•": 50,
      "ä¸æ”¯æŒï¼Œæˆ‘è®¤ä¸ºä¸­åŒ»åº”è¯¥ä¿æŒä¼ ç»Ÿ": 0,
      "æ˜¯çš„ï¼ŒäºŒè€…å¯ä»¥äº’ç›¸è¡¥å……": 100,
      "ä¸ç¡®å®šï¼ŒäºŒè€…æœ‰æ—¶ä¼šå†²çª": 50,
      "ä¸è®¤ä¸ºï¼Œè¥¿åŒ»æ‰æ˜¯å”¯ä¸€æœ‰æ•ˆçš„æ²»ç–—æ–¹æ³•": 0,
      "å®Œå…¨è®¤ä¸ºï¼Œä¸­åŒ»æœ‰åŠ©äºè°ƒèŠ‚æƒ…ç»ªå’Œå‹åŠ›": 100,
      "æœ‰ä¸€å®šæ•ˆæœï¼Œä½†æ›´ä¾èµ–äºä¸ªäººæƒ…å†µ": 50,
      "ä¸è®¤ä¸ºï¼Œä¸­åŒ»æ— æ³•æœ‰æ•ˆè°ƒèŠ‚æƒ…ç»ª": 0,
      "è®¤ä¸ºå¯ä»¥ï¼Œæœªæ¥ç§‘æŠ€å’Œä¸­åŒ»ä¼šæ‰¾åˆ°å®Œç¾çš„ç»“åˆç‚¹": 100,
      "è®¤ä¸ºæœ‰ä¸€å®šæŒ‘æˆ˜ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½èåˆæˆåŠŸ": 50,
      "ä¸è®¤ä¸ºï¼Œç§‘æŠ€å’Œä¸­åŒ»æ— æ³•å®Œå…¨èåˆ": 0
    }[option.text] || 50;
    gameData.score += choiceValue;
    updateProgress();
    updateStats();
    container.classList.add('scene-exit-active');
    setTimeout(() => {
      container.remove();
      gameData.currentLevel++;
      if (gameData.currentLevel < questions.length) {
        const newContainer = createLevel(questions[gameData.currentLevel]);
        document.getElementById('gameContainer').appendChild(newContainer);
      } else {
        showGameOver();
      }
    }, 800);
  });
  return button;
}
function createLevel(levelData) {
  const container = document.createElement('div');
  container.className = 'story-section scene-enter';
  const transition = document.createElement('div');
  transition.className = 'background-transition';
  container.appendChild(transition);
  if (levelData.character) {
    const portrait = document.createElement('div');
    portrait.className = 'character-portrait';
    portrait.innerHTML = `<div class="character-image"></div>`;
    container.appendChild(portrait);
  }
  const pattern = document.createElement('div');
  pattern.className = 'scene-pattern';
  container.appendChild(pattern);
  const storyText = document.createElement('div');
  storyText.className = 'story-text';
  container.appendChild(storyText);
  function typewriterEffect(text, element) {
    const speed = 40;
    let i = 0;
    element.textContent = '';
    return new Promise(resolve => {
      function addChar() {
        if (i < text.length) {
          element.textContent += text.charAt(i);
          const nextChar = text.charAt(i);
          let delay = speed;
          if (['.', '!', '?', 'ã€‚', 'ï¼', 'ï¼Ÿ'].includes(nextChar)) {
            delay = speed * 8;
          } else if (['.', ','].includes(nextChar)) {
            delay = speed * 4;
          }
          i++;
          setTimeout(addChar, delay);
        } else {
          resolve();
        }
      }
      addChar();
    });
  }
  typewriterEffect(levelData.story, storyText).then(() => {
    const questionElement = document.createElement('div');
    questionElement.className = 'question';
    questionElement.style.cssText = `
            font-size: 1.5rem;
            margin: 2rem 0;
            color: #00ff87;
            text-shadow: 0 0 10px rgba(0,255,135,0.5);
            padding: 1rem;
            background: rgba(0,0,0,0.6);
            border-radius: 10px;
        `;
    return typewriterEffect(levelData.question, questionElement).then(() => {
      container.appendChild(questionElement);
      const optionsContainer = document.createElement('div');
      optionsContainer.className = 'options';
      optionsContainer.style.marginTop = '2rem';
      levelData.options.forEach((option, index) => {
        setTimeout(() => {
          const button = createOptionButton(option, container);
          optionsContainer.appendChild(button);
          button.style.opacity = '0';
          button.style.transform = 'translateX(-20px)';
          requestAnimationFrame(() => {
            button.style.opacity = '1';
            button.style.transform = 'translateX(0)';
          });
        }, index * 300);
      });
      container.appendChild(optionsContainer);
    });
  });
  requestAnimationFrame(() => {
    container.classList.remove('scene-enter');
  });
  return container;
}
function transitionToNextScene(currentContainer, nextLevelData) {
  const overlay = document.createElement('div');
  overlay.className = 'scene-transition-overlay';
  document.body.appendChild(overlay);
  const particleSystem = new ParticleSystem();
  for (let i = 0; i < 20; i++) {
    const x = Math.random() * window.innerWidth;
    const y = Math.random() * window.innerHeight;
    particleSystem.emit(x, y, 5, 'transition');
  }
  requestAnimationFrame(() => {
    overlay.classList.add('scene-transition-active');
    setTimeout(() => {
      currentContainer.remove();
      const newContainer = createLevel(nextLevelData);
      document.getElementById('gameContainer').appendChild(newContainer);
      const progress = gameData.currentLevel / gameData.totalLevels * 100;
      document.getElementById('storyProgressFill').style.width = `${progress}%`;
      setTimeout(() => {
        overlay.classList.remove('scene-transition-active');
        setTimeout(() => overlay.remove(), 500);
      }, 500);
    }, 500);
  });
}
function updateProgress() {
  const progress = gameData.currentLevel / gameData.totalLevels * 100;
  document.getElementById('progressBar').style.width = `${progress}%`;
  document.getElementById('currentLevel').textContent = `ç¬¬ ${gameData.currentLevel + 1} å…³ / ${gameData.totalLevels} å…³`;
}
function showAchievement(text) {
  if (!achievementList.includes(text)) {
    achievementList.push(text);
    updateAchievementsList();
  }
  const toast = document.createElement('div');
  toast.className = 'achievement-toast';
  toast.innerHTML = `
    <h3>æˆå°±è§£é”ï¼</h3>
    <p>${text}</p>
    <small>${new Date().toLocaleString()}</small>
  `;
  document.body.appendChild(toast);
  setTimeout(() => {
    toast.classList.add('toast-fade-out');
    setTimeout(() => {
      toast.remove();
    }, 500);
  }, 5000);
  const particleSystem = new ParticleSystem();
  for (let i = 0; i < 10; i++) {
    const x = Math.random() * window.innerWidth;
    const y = Math.random() * window.innerHeight;
    particleSystem.emit(x, y, 5, 'achievement');
  }
}
function updateAchievementsList() {
  const achievementsList = document.querySelector('.achievements-list');
  if (achievementsList) {
    let content = '';
    if (gameData.inventory.length > 0) {
      content += `
        <div class="achievement-category">
          <h3>æ”¶é›†ç‰©å“ (${gameData.inventory.length}ä¸ª)</h3>
          <div class="achievement-category-description">
            æ¢ç´¢æ¸¸æˆè¿‡ç¨‹ä¸­è·å¾—çš„çè´µç‰©å“ï¼Œæ¯ä¸ªç‰©å“éƒ½è•´å«ç€ç‹¬ç‰¹çš„ä»·å€¼å’Œæ„ä¹‰ã€‚
          </div>
      `;
      gameData.inventory.forEach(item => {
        content += `
          <div class="achievement-list-item inventory-item">
            <div class="item-header">
              <span class="achievement-icon">ğŸ</span>
              <span class="achievement-title">${item}</span>
            </div>
            <div class="item-details">
              <p class="item-description">${getItemDescription(item)}</p>
              <span class="item-rarity">çç¨€åº¦: ${getItemRarity(item)}</span>
              <span class="item-acquisition">è·å¾—æ—¶é—´: ${new Date().toLocaleString()}</span>
            </div>
          </div>
        `;
      });
      content += '</div>';
    }
    if (achievementList.length > 0) {
      content += `
        <div class="achievement-category">
          <h3>æ¸¸æˆæˆå°± (${achievementList.length}ä¸ª)</h3>
          <div class="achievement-category-description">
            åœ¨æ¸¸æˆè¿‡ç¨‹ä¸­è§£é”çš„ç‰¹æ®Šæˆå°±ï¼Œè®°å½•ç€ä½ çš„æ¢ç´¢å†ç¨‹å’Œé‡è¦æ—¶åˆ»ã€‚
          </div>
      `;
      achievementList.forEach(achievement => {
        content += `
          <div class="achievement-list-item">
            <div class="achievement-header">
              <span class="achievement-icon">ğŸ†</span>
              <span class="achievement-title">${achievement}</span>
            </div>
            <div class="achievement-details">
              <p class="achievement-description">${getAchievementDescription(achievement)}</p>
              <span class="achievement-date">è§£é”æ—¶é—´: ${new Date().toLocaleString()}</span>
            </div>
          </div>
        `;
      });
      content += '</div>';
    }
    if (!content) {
      content = `
        <div class="achievement-list-empty">
          <div class="empty-icon">ğŸ”</div>
          <h3>æš‚æ— æˆå°±</h3>
          <p>ç»§ç»­æ¢ç´¢æ¸¸æˆæ¥è·å¾—æ›´å¤šæˆå°±å’Œç‰©å“ï¼æ¯ä¸ªé€‰æ‹©éƒ½å¯èƒ½å¸¦æ¥æ„æƒ³ä¸åˆ°çš„æ”¶è·ã€‚</p>
        </div>
      `;
    }
    achievementsList.innerHTML = content;
  }
}
function getItemRarity(item) {
  const rarityMap = {
    "ç°ä»£æ™ºæ…§è‰è¯": "ä¼ è¯´çº§",
    "æ¢ç´¢è‰è¯": "ç¨€æœ‰",
    "ä¼ ç»Ÿç§˜æ–¹": "å²è¯—çº§",
    "å’Œè°ä¹‹é“": "ä¼ è¯´çº§",
    "æ€€ç–‘ä¹‹é—¨": "ç¨€æœ‰",
    "å•ä¸€æ²»ç–—æ³•": "æ™®é€š"
  };
  return rarityMap[item] || "æ™®é€š";
}
function getAchievementDescription(achievement) {
  const descriptionMap = {
    "æ”¶é›†è€…ï¼šè·å¾—5ä»¶ç‰©å“ï¼": "åˆæ­¥æ¢ç´¢ä¸–ç•Œï¼Œæ”¶é›†äº†5ä»¶ç‹¬ç‰¹ç‰©å“ï¼Œå±•ç°å‡ºæ¢ç´¢è€…çš„æ½œåŠ›ã€‚",
    "æ¢ç´¢å¤§å¸ˆï¼šè·å¾—10ä»¶ç‰©å“ï¼": "æ·±å…¥æ¢ç´¢ä¸–ç•Œï¼Œæ”¶é›†äº†10ä»¶çè´µç‰©å“ï¼Œè¯æ˜äº†ä½ çš„æ¢ç´¢å®åŠ›ã€‚",
    "æ¸¸æˆé€šå…³ï¼æ­å–œå®Œæˆæ‰€æœ‰å…³å¡ï¼": "å®Œæˆäº†æ‰€æœ‰æŒ‘æˆ˜ï¼Œè§è¯äº†å®Œæ•´çš„æ•…äº‹ï¼Œä½ æ˜¯çœŸæ­£çš„å‹‡è€…ï¼"
  };
  return descriptionMap[achievement] || "ä¸€ä¸ªç¥ç§˜çš„æˆå°±ï¼Œç»§ç»­æ¢ç´¢æ¥äº†è§£æ›´å¤šï¼";
}
const audioContext = new (window.AudioContext || window.webkitAudioContext)();
const soundEffects = {
  click: createClickSound(),
  achievement: createAchievementSound(),
  transition: createTransitionSound()
};
function createClickSound() {
  const oscillator = audioContext.createOscillator();
  const gainNode = audioContext.createGain();
  oscillator.connect(gainNode);
  gainNode.connect(audioContext.destination);
  oscillator.type = 'sine';
  oscillator.frequency.value = 800;
  gainNode.gain.value = 0.1;
  return {
    play: () => {
      oscillator.start();
      setTimeout(() => oscillator.stop(), 50);
    }
  };
}
function createAchievementSound() {
  const oscillator = audioContext.createOscillator();
  const gainNode = audioContext.createGain();
  oscillator.connect(gainNode);
  gainNode.connect(audioContext.destination);
  oscillator.type = 'sine';
  oscillator.frequency.value = 1200;
  gainNode.gain.value = 0.1;
  return {
    play: () => {
      oscillator.start();
      setTimeout(() => oscillator.stop(), 50);
    }
  };
}
function createTransitionSound() {
  const oscillator = audioContext.createOscillator();
  const gainNode = audioContext.createGain();
  oscillator.connect(gainNode);
  gainNode.connect(audioContext.destination);
  oscillator.type = 'sine';
  oscillator.frequency.value = 1000;
  gainNode.gain.value = 0.1;
  return {
    play: () => {
      oscillator.start();
      setTimeout(() => oscillator.stop(), 50);
    }
  };
}
const saveSystem = {
  saveGame: () => {
    const saveData = {
      currentLevel: gameData.currentLevel,
      inventory: gameData.inventory,
      score: gameData.score,
      achievements: achievementList
    };
    localStorage.setItem('visualNovelSave', JSON.stringify(saveData));
    showNotification('æ¸¸æˆå·²ä¿å­˜');
    const particleSystem = new ParticleSystem();
    for (let i = 0; i < 10; i++) {
      const x = Math.random() * window.innerWidth;
      const y = Math.random() * window.innerHeight;
      particleSystem.emit(x, y, 5, 'achievement');
    }
  },
  loadGame: () => {
    const saveData = localStorage.getItem('visualNovelSave');
    if (saveData) {
      const data = JSON.parse(saveData);
      gameData.currentLevel = data.currentLevel;
      gameData.inventory = data.inventory;
      gameData.score = data.score;
      achievementList.length = 0;
      achievementList.push(...data.achievements);
      updateAchievementsList();
      showLevel(gameData.currentLevel);
      updateStats();
      showNotification('æ¸¸æˆå·²è¯»å–');
    }
  }
};
function showNotification(message) {
  const notification = document.createElement('div');
  notification.className = 'notification';
  notification.textContent = message;
  document.body.appendChild(notification);
  setTimeout(() => {
    notification.classList.add('fade-out');
    setTimeout(() => notification.remove(), 500);
  }, 2000);
}
const menuToggle = document.getElementById('menuToggle');
const gameMenu = document.getElementById('gameMenu');
menuToggle.addEventListener('click', () => {
  gameMenu.classList.toggle('active');
});
document.addEventListener('click', e => {
  if (!gameMenu.contains(e.target) && !menuToggle.contains(e.target)) {
    gameMenu.classList.remove('active');
  }
});
function returnToHome() {
  const startScreen = document.getElementById('startScreen');
  const gameContainer = document.getElementById('gameContainer');
  gameContainer.style.display = 'none';
  startScreen.style.display = 'flex';
  startScreen.style.opacity = '1';
  gameData.currentLevel = 0;
  gameData.score = 0;
  gameData.inventory = [];
  updateStats();
  document.getElementById('inventoryItems').innerHTML = '';
  gameMenu.classList.remove('active');
  showNotification('å·²è¿”å›ä¸»é¡µ');
}
window.addEventListener('load', () => {
  const startScreen = document.getElementById('startScreen');
  const startButton = document.getElementById('startButton');
  const gameContainer = document.getElementById('gameContainer');
  gameContainer.style.display = 'none';
  const description = document.querySelector('.start-description');
  const listItems = description.querySelectorAll('li');
  listItems.forEach((item, index) => {
    item.style.opacity = '0';
    item.style.transform = 'translateX(-20px)';
    setTimeout(() => {
      item.style.opacity = '1';
      item.style.transform = 'translateX(0)';
      item.style.transition = 'all 0.5s ease';
    }, index * 200);
  });
  startButton.addEventListener('click', () => {
    startScreen.style.opacity = '0';
    startScreen.style.transition = 'opacity 0.5s ease';
    const loadingScreen = document.createElement('div');
    loadingScreen.className = 'loading-screen';
    loadingScreen.innerHTML = `
        <h2 style="color: #fff; margin-bottom: 20px;">åŠ è½½æ¸¸æˆèµ„æºä¸­...</h2>
        <div class="loading-bar">
            <div class="loading-progress"></div>
        </div>
        <div class="loading-text">æ­£åœ¨åˆå§‹åŒ–æ¸¸æˆ...</div>
    `;
    document.body.appendChild(loadingScreen);
    const progressBar = loadingScreen.querySelector('.loading-progress');
    const loadingText = loadingScreen.querySelector('.loading-text');
    let progress = 0;
    const loadingInterval = setInterval(() => {
      progress += Math.random() * 15;
      if (progress > 100) progress = 100;
      progressBar.style.width = `${progress}%`;
      if (progress < 30) {
        loadingText.textContent = "æ­£åœ¨åŠ è½½æ¸¸æˆèµ„æº...";
      } else if (progress < 60) {
        loadingText.textContent = "å‡†å¤‡æ¸¸æˆåœºæ™¯...";
      } else if (progress < 90) {
        loadingText.textContent = "å³å°†è¿›å…¥æ¸¸æˆ...";
      } else {
        loadingText.textContent = "è½½å…¥å®Œæˆï¼";
      }
      if (progress === 100) {
        clearInterval(loadingInterval);
        setTimeout(() => {
          loadingScreen.style.opacity = '0';
          loadingScreen.style.transition = 'opacity 0.5s ease';
          setTimeout(() => {
            loadingScreen.remove();
            startScreen.style.display = 'none';
            gameContainer.style.display = 'block';
            gameData.currentLevel = 0;
            gameData.score = 0;
            gameData.inventory = [];
            achievementList.length = 0;
            showLevel(0);
            updateStats();
            const particleSystem = new ParticleSystem();
            for (let i = 0; i < 20; i++) {
              const x = Math.random() * window.innerWidth;
              const y = Math.random() * window.innerHeight;
              particleSystem.emit(x, y, 5, 'transition');
            }
          }, 500);
        }, 1000);
      }
    }, 100);
  });
  achievementSystem.updateAchievementList();
});
document.addEventListener('DOMContentLoaded', () => {
  const gameControls = document.querySelector('.game-controls');
  if (gameControls) {
    gameControls.remove();
  }
});
function showLevel(levelIndex) {
  const transition = document.querySelector('.background-transition');
  transition.classList.add('active');
  setTimeout(() => {
    const gameContainer = document.getElementById('gameContainer');
    const currentSection = gameContainer.querySelector('.story-section');
    if (currentSection) {
      currentSection.remove();
    }
    if (levelIndex < questions.length) {
      const newSection = createLevel(questions[levelIndex]);
      gameContainer.appendChild(newSection);
      if (gameFeatures.particles) {
        const particleSystem = new ParticleSystem();
        for (let i = 0; i < 5; i++) {
          const x = Math.random() * window.innerWidth;
          const y = Math.random() * window.innerHeight;
          particleSystem.emit(x, y);
        }
        function updateParticles() {
          particleSystem.update();
          if (particleSystem.particles.length > 0) {
            requestAnimationFrame(updateParticles);
          }
        }
        updateParticles();
      }
    } else {
      showGameOver();
    }
    setTimeout(() => {
      transition.classList.remove('active');
    }, 500);
  }, 500);
}
function showGameOver() {
  const gameOver = document.getElementById('gameOver');
  const analysis = analyzeChoices();
  gameOver.innerHTML = `
    <h2>æ¸¸æˆç»“æŸï¼</h2>
    <div class="analysis-container">
      <h3 class="analysis-title">ä½ çš„ä¸­åŒ»æ€åº¦åˆ†æ</h3>
      <div class="analysis-score">
        å¾—åˆ†: ${analysis.actualScore} / ${analysis.totalPossibleScore}
      </div>
      <div class="analysis-text">
        <p><strong>ä½ çš„èº«ä»½æ˜¯:</strong> ${analysis.identity}</p>
        <p><strong>ä¸­åŒ»è®¤å¯åº¦:</strong> ${analysis.tcmPreferenceScore}%</p>
        <p><strong>è¯¦ç»†åˆ†æ:</strong> ${analysis.analysis}</p>
      </div>
      <div class="roast-text">
        ${analysis.roast}
      </div>
      <div class="qr-code-section">
        <h3>åŠ å…¥æˆ‘ä»¬çš„ä¸­åŒ»æ™ºèƒ½åŒ–æ¢ç´¢ç¤¾åŒºï¼</h3>
        <p>æ‰«æä¸‹æ–¹äºŒç»´ç ï¼Œä¸å…¶ä»–æ¢ç´¢è€…äº¤æµåˆ†äº«ä½ çš„è§è§£ã€‚</p>
        <div class="qr-code-container">
          <svg class="qr-code" viewBox="0 0 41 41">
            <path d="M1 1h7v7h-7zM33 1h7v7h-7zM1 33h7v7h-7z" fill="#00ff87"/>
            <path d="M10 1h3v1h-3zM16 1h4v1h-4zM24 1h3v1h-3zM10 7h3v1h-3zM16 7h4v1h-4zM24 7h3v1h-3zM1 10h1v3h-1zM7 10h1v3h-1zM33 10h1v3h-1zM39 10h1v3h-1zM1 16h1v4h-1zM7 16h1v4h-1zM33 16h1v4h-1zM39 16h1v4h-1zM1 24h1v3h-1zM7 24h1v3h-1zM33 24h1v3h-1zM39 24h1v3h-1zM10 33h3v1h-3zM16 33h4v1h-4zM24 33h3v1h-3zM10 39h3v1h-3zM16 39h4v1h-4zM24 39h3v1h-3z" fill="#00ff87"/>
          </svg>
        </div>
        <p>åŠ å…¥æˆ‘ä»¬ï¼Œå¼€å¯æ›´å¤šå…³äºä¸­åŒ»æ™ºèƒ½åŒ–çš„ç²¾å½©å¯¹è¯ï¼</p>
      </div>
    </div>
  `;
  gameOver.style.display = 'block';
  showAchievement('æ¸¸æˆé€šå…³ï¼æ­å–œå®Œæˆæ‰€æœ‰å…³å¡ï¼');
  const particleSystem = new ParticleSystem();
  for (let i = 0; i < 20; i++) {
    const x = Math.random() * window.innerWidth;
    const y = Math.random() * window.innerHeight;
    particleSystem.emit(x, y, 10, 'achievement');
  }
}
function updateStats() {
  document.getElementById('questsCompleted').textContent = gameData.currentLevel;
  document.getElementById('itemsCollected').textContent = gameData.inventory.length;
  document.getElementById('score').textContent = gameData.score;
}
function analyzeChoices() {
  let traditionalScore = 0;
  let modernScore = 0;
  const totalPossibleScore = gameData.currentLevel * 100;
  const actualScore = gameData.score;
  const tcmPreferenceScore = actualScore / totalPossibleScore * 100;
  let identity = '';
  let roast = '';
  let analysis = '';
  if (tcmPreferenceScore >= 75) {
    identity = 'åšå®šçš„ä¸­åŒ»ä¼ ç»Ÿæ´¾';
    roast = 'ä½ å¯¹ä¸­åŒ»çš„è®¤å¯åº¦éå¸¸é«˜ï¼Œçœ‹æ¥æ˜¯ä¸ªçœŸæ­£çš„ä¸­åŒ»ç²‰ä¸ï¼';
    analysis = 'ä»ä½ çš„é€‰æ‹©æ¥çœ‹ï¼Œä½ éå¸¸æ”¯æŒä¸­åŒ»çš„å‘å±•å’Œåˆ›æ–°ï¼ŒåŒæ—¶ä¹Ÿè®¤å¯ä¼ ç»Ÿä»·å€¼ã€‚';
  } else if (tcmPreferenceScore >= 50) {
    identity = 'æ¸©å’Œçš„ä¸­åŒ»æ”¯æŒè€…';
    roast = 'æ—¢ä¸æ’æ–¥ä¼ ç»Ÿä¹Ÿä¸æ‹’ç»åˆ›æ–°ï¼Œç›¸å½“ç†æ€§çš„æ€åº¦ï¼';
    analysis = 'ä½ å¯¹ä¸­åŒ»æŒå¼€æ”¾æ€åº¦ï¼Œèƒ½æ¥å—ä¼ ç»Ÿä¸ç°ä»£çš„ç»“åˆã€‚è¿™ç§å¹³è¡¡çš„è§‚ç‚¹å€¼å¾—è‚¯å®šã€‚';
  } else if (tcmPreferenceScore >= 25) {
    identity = 'ç§‘æŠ€æ´¾ä¸­åŒ»è§‚å¯Ÿè€…';
    roast = 'çœ‹æ¥ä½ å¯¹ä¸­åŒ»æŒè°¨æ…æ€åº¦ï¼Œæ›´ç›¸ä¿¡ç§‘æŠ€çš„åŠ›é‡ï¼Ÿ';
    analysis = 'ä½ å€¾å‘äºç”¨ç°ä»£çœ¼å…‰çœ‹å¾…ä¸­åŒ»ï¼Œè¿™ç§å®¡æ…çš„æ€åº¦ä¹Ÿæœ‰å…¶åˆç†æ€§ã€‚';
  } else {
    identity = 'ä¸­åŒ»æ€€ç–‘æ´¾';
    roast = 'çœ‹æ¥ä½ æ˜¯ä¸ªå½»åº•çš„ç§‘æŠ€æ´¾ï¼ä¸è¿‡ä¸­åŒ»çš„æ™ºæ…§ä¹Ÿè®¸å€¼å¾—ä¸€æ¢ï¼Ÿ';
    analysis = 'ä»ä½ çš„é€‰æ‹©æ¥çœ‹ï¼Œä½ å¯¹ä¸­åŒ»æŒè¾ƒä¸ºæ€€ç–‘çš„æ€åº¦ï¼Œæ›´ä¿¡èµ–ç°ä»£åŒ»å­¦ã€‚';
  }
  return {
    actualScore,
    totalPossibleScore,
    tcmPreferenceScore,
    identity,
    roast,
    analysis
  };
}</script>
</body>
</html>
